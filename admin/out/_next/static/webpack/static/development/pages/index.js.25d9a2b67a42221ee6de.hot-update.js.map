{"version":3,"file":"static/webpack/static\\development\\pages\\index.js.25d9a2b67a42221ee6de.hot-update.js","sources":["webpack:///./components/AddTargetModal.js"],"sourcesContent":["import React from 'react';\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { fetchTargetAdd } from '../fetchers/targets';\r\nimport { fetchAppAuth } from '../fetchers/userconfig';\r\nimport OAuthAppForm from './OAuthAppForm';\r\nimport OAuthSetupPrompt from './OAuthSetupPrompt';\r\n\r\nfunction dismissSelf(setProtocol, setPathVal, setIsAdding) {\r\n  setProtocol('file');\r\n  setPathVal('');\r\n  setIsAdding(false);\r\n}\r\n\r\nasync function handleSaveClick(url, setErrorMessage, setProtocol, setPathVal, setIsAdding) {\r\n  try {\r\n    await fetchTargetAdd(url);\r\n    dismissSelf(setProtocol, setPathVal, setIsAdding);\r\n  } catch (err) {\r\n    setErrorMessage('' + err);\r\n  }\r\n}\r\n\r\nfunction nameForProtocol(protocol) {\r\n  switch (protocol) {\r\n  case 'file':\r\n    return 'Local Directory';\r\n  case 'gdrive':\r\n    return 'Google Drive';\r\n  case 'dropbox':\r\n    return 'Dropbox';\r\n  case 's3':\r\n    return 'S3';\r\n  }\r\n  return 'Unknown';\r\n}\r\n\r\nfunction placeholderForProtocol(protocol) {\r\n  switch (protocol) {\r\n  case 'file':\r\n    return '/path/to/your/media/directory';\r\n  case 'gdrive':\r\n    return '/Mediasummon';\r\n  case 'dropbox':\r\n    return '/Mediasummon';\r\n  case 's3':\r\n    return 'bucketname';\r\n  }\r\n  return 'Unknown';\r\n}\r\n\r\nfunction initialPathForProtocol(protocol) {\r\n  switch (protocol) {\r\n  case 'gdrive':\r\n    return '/Mediasummon';\r\n  case 'dropbox':\r\n    return '/Mediasummon';\r\n  }\r\n  return '';\r\n}\r\n\r\nasync function refreshAppAuth(setAppAuth, setErrorMessage) {\r\n  try {\r\n    setAppAuth(await fetchAppAuth());\r\n  } catch (err) {\r\n    setErrorMessage(err);\r\n  }\r\n}\r\n\r\nexport default function AddTargetModal({ enabled, setIsAdding }) {\r\n  const [errorMessage, setErrorMessage] = useState(null);\r\n  const [selfVal, setSelfVal] = useState(null);\r\n  const [protocol, setProtocol] = useState('file');\r\n  const [pathVal, setPathVal] = useState(initialPathForProtocol(protocol));\r\n  const [appAuth, setAppAuth] = useState(undefined);\r\n  const [configuring, setConfiguring] = useState(false);\r\n  const closeListener = useCallback(() => {\r\n    dismissSelf(setProtocol, setPathVal, setIsAdding);\r\n  }, []);\r\n  useEffect(() => {\r\n    const showing = selfVal && enabled;\r\n    var modal = null;\r\n    if (selfVal) {\r\n      modal = require('uikit').modal(selfVal);\r\n      selfVal.addEventListener('hidden', closeListener);\r\n    }\r\n    if (modal && showing) {\r\n      modal.show();\r\n    }\r\n    return () => {\r\n      if (modal && showing) {\r\n        modal.hide();\r\n      }\r\n    };\r\n  }, [selfVal, enabled]);\r\n  useEffect(() => {\r\n    refreshAppAuth(setAppAuth, setErrorMessage);\r\n  }, [enabled])\r\n  const closeCallback = useCallback(ev => {\r\n    ev.preventDefault();\r\n    dismissSelf(setProtocol, setPathVal, setIsAdding);\r\n  }, []);\r\n  const refCallback = useCallback(ref => {\r\n    setSelfVal(ref);\r\n  }, []);\r\n  const protocolChangeCallback = useCallback(ev => {\r\n    setProtocol(ev.target.value);\r\n    setPathVal(initialPathForProtocol(ev.target.value));\r\n  }, []);\r\n  const pathValueChangeCallback = useCallback(ev => {\r\n    setPathVal(ev.target.value);\r\n  }, []);\r\n  const saveCallback = useCallback(ev => {\r\n    ev.preventDefault();\r\n    const extra = protocol === 'file' ? '/' : '';\r\n    handleSaveClick(protocol +'://' + extra + pathVal, setErrorMessage, setProtocol, setPathVal, setIsAdding);\r\n  }, [protocol, pathVal]);\r\n  const handleConfigureClick = useCallback(ev => {\r\n    ev.preventDefault();\r\n    setConfiguring(true);\r\n  }, []);\r\n  const handleSetShowing = useCallback(showing => {\r\n    setConfiguring(showing);\r\n    if (!showing) {\r\n      refreshAppAuth(setAppAuth, setErrorMessage);\r\n    }\r\n  }, []);\r\n  const protocolAuth = appAuth ? appAuth[protocol] : null;\r\n  const tooltipString = protocolAuth ? protocolAuth.app_create_url.split('/')[2] : null;\r\n  return (\r\n    <div uk-modal=\"true\" ref={refCallback}>\r\n      <div className=\"uk-modal-dialog\">\r\n        <button\r\n          className=\"uk-modal-close-default\"\r\n          type=\"button\"\r\n          uk-close=\"true\" />\r\n        <div className=\"uk-modal-header\">\r\n          <h2 className=\"uk-modal-title\">Summon your media to an additional location</h2>\r\n        </div>\r\n        <div className=\"uk-modal-body\">\r\n          {errorMessage ? \r\n            <div className=\"uk-alert-danger\" uk-alert=\"true\">\r\n              <p><span uk-icon=\"warning\" /> {errorMessage}</p>\r\n            </div> : null}\r\n          {configuring && protocolAuth ?\r\n            <div className=\"uk-margin\">\r\n              {protocolAuth.needs_app ?\r\n                <p>\r\n                  Visit {protocol} to <a href={protocolAuth.app_create_url} uk-tooltip={tooltipString} target=\"_blank\">create an app</a>, then return here and enter the credentials below:\r\n                </p> :\r\n                <p>\r\n                  You already have credentials set up for {protocol}. If you would like to set new app credentials, head over to their site to <a href={protocolAuth.app_create_url} uk-tooltip={tooltipString} target=\"_blank\">create or update your app</a>, then return here and enter the credentials below:\r\n                </p>}\r\n              <OAuthAppForm secretName={protocol} setShowing={handleSetShowing} />\r\n            </div> : null}\r\n          {!configuring && protocolAuth && (protocolAuth.needs_app || protocolAuth.needs_credentials) ?\r\n            <div className=\"uk-margin\">\r\n              <OAuthSetupPrompt kind=\"target\" name={protocol} item={protocolAuth} onConfigureClick={handleConfigureClick} />\r\n            </div> : null}\r\n          <p>Choose the location where you would like to save your media</p>\r\n          <form className=\"uk-form uk-flex\" onSubmit={saveCallback}>\r\n            <input type=\"submit\" onSubmit={saveCallback} style={{display: 'none'}} />\r\n            <span className=\"uk-width-auto\" uk-form-custom=\"target: true\">\r\n              <input className=\"uk-input uk-width-auto\" type=\"text\" placeholder={nameForProtocol(protocol)} />\r\n              <select className=\"uk-select\" onChange={protocolChangeCallback} value={protocol}>\r\n                <option value=\"file\">{nameForProtocol('file')}</option>\r\n                <option value=\"s3\">{nameForProtocol('s3')}</option>\r\n                <option value=\"dropbox\">{nameForProtocol('dropbox')}</option>\r\n                {/*\r\n                <option value=\"gdrive\">{nameForProtocol('gdrive')}</option>\r\n                */}\r\n              </select>\r\n            </span>\r\n            <input\r\n              type=\"text\"\r\n              className=\"uk-input uk-width-expand\" \r\n              placeholder={placeholderForProtocol(protocol)}\r\n              onChange={pathValueChangeCallback}\r\n              value={pathVal}\r\n              disabled={!protocolAuth || protocolAuth.needs_credentials} />\r\n          </form>\r\n        </div>\r\n        <div className=\"uk-modal-footer uk-text-right\">\r\n          <button className=\"uk-button uk-button-default\" type=\"button\" onClick={closeCallback}>Cancel</button>\r\n          <button className=\"uk-button uk-button-primary\" type=\"button\" onClick={saveCallback}>Save</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAGA;AAHA;AAAA;AACA;AADA;AAAA;AAAA;AAKA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;AASA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AARA;AACA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AARA;AACA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAJA;AACA;AAKA;AACA;AACA;AACA;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAIA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;AAQA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AACA;AACA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;;;;A","sourceRoot":""}